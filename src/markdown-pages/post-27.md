---
slug: "/javascripts-27"
date: "2022-08-16"
title: "모던 자바스크립트 딥다이브 CH24"
tags: ["JavaScript", "ALL"]
featuredimage:
  src: "../images/thumbnail/JM.png"
  alt: "모던자바스크립트"
---

# #23

# 실행 컨텍스트

## 소스코드

ECMA 스크립트에서 소스코드를 4가지 사양으로 구분합니다.

| 소스 코드의 타입 | 설명                                                                                                             |
| ---------------- | ---------------------------------------------------------------------------------------------------------------- |
| 전역 코드        | 전역에 존재하는 소스 코드를 이야기합니다. 전역에 정의된 함수, 클래스등의 내부 코드는 포함되지 않습니다           |
| 함수코드         | 함수내부에 존재하는 소스 코드를 이야기합니다. 함수 내부에 중첩된 함수, 글래스 등의 내부 코드는 포함되지 않습니다 |
| eval 코드        | 빌트인 전역 함수인 eval에 함수에 인수로 전달되어 실행되는 소스 코드를 말합니다                                   |
| 모듈 코드        | 모듈 내부에 존재하는 소스코드를 이야기합니다. 모듈 내부의 함수, 클래스 등의 내부 코드는 포함되지 않습니다        |

각각의 코드들은 각 타입에 따라, 실행 컨택스트를 생성하게 되는데 이때의 과정과 관리 내용은 코드별로 상이합니다.

## 소스코드 평가와 실행

모든 소스 코드는, 두가지 과정을 걸쳐 실행됩니다. 그 두가지 과정은 바로 소스코드의 평가와 실행이라 할 수 있습니다.

### 소스코드의 평가와 실행 과정

1. 평가 과정

실행 컨텍스트의 생성하고 변수, 함수등의 선언문만 먼저 실행해 생성된 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프에 등록합니다.

1. 소스코드의 실행

평가 과정이 끝나면, 선언문을 제외한 소스코드가 실행 됩니다. 런타임이 진행되며 소스코드 실행에 필요한 정보를 취득하게 됩니다. 이때 변수의 값의 변경 등 소스코드의 실행 결과는 다시 실행 컨텍스트가 관리하는 스코프에 등록되게 됩니다.

코드를 통해 확인해볼까요?

```jsx
var x;
x = 1;
```

위와 같은 코드가 있을때 자바 스크립트 엔진은 아래의 흐름으로 진행하게 됩니다.

1. 소스코드 평가 과정

변수 선언문 `var x;` 를 먼저 실행하고, x는 실행 컨텍스트가 관리하는 스코프에 등록되고 `undefined` 로 초기화됩니다.

1. 소스코드 실행

평가 과정 이후 변수 할당문 `x=1;` 이 실행되게 됩니다. 이때 x에 변수에 값을 할당하기 위해 x 가 선언된 변수 인지 실행컨텍스트가 관리하는 스코프에 x변수가 등록되어있는지 확인합니다. 여기서 **등록** 이란 , 소스 코드 평가 후에, 선언문이 실행되어 스코프에 등록되었는지를 의미하며, 만약 선언된 값이하면 1이라는 값을 할당하고 할당 결과를 실행 컨텍스트에 등록 해 관리하게 됩니다.

## 실행 컨텍스트의 역할

실행 컨텍스트를 아래의 코드를 통해 확인해볼까요

```jsx
// 전역 변수 선언
const x = 1;
const y = 2;

// 함수 정의
function foo(a) {
  // 지역 변수 선언
  const x = 10;
  const y = 20;

  // 메서드 호출
  console.log(a + x + y); // 130
}

// 함수 호출
foo(100);

// 메서드 호출
console.log(x + y); // 3
```

일단 위에서 언급 했던 것처럼, 각각의 코드에 따른 평가과정이 존재하기 때문에, 코드별로 나누어 진행해 보겠습니다.

### 전역 코드

1. 코드 평가

소스코드 평가 과정에서는, 선언문만 먼저 실행 되기 때문에, 변수 선언문과 함수 선언문이 먼저 실행되고, 그 결과생성된 전역 변수와 전역 함수가 실행컨텍스트가 관리하는 전역 스코프에 등록하게됩니다.

이때 var 키워드로 선언된 전역 변수와 함수 선언 문은 전역 객체의 프로퍼티와 메서드가 됩니다.

1. 코드 실행

전역 코드 평가 과정이 끝나면, 전역 코드가 순차적으로실행하게 됩니다. 전역 변수에 값이 할당 되고, 함수가 호출됩니다. 함수 호출 시 실행 되던 전역 코드의 실행을 일시 중단하고 실행 순서를 변경해 함수 내부로 진입합니다

### 함수 코드

1. 코드 평가

함수 호출에 의해 함수 내부로 진입하게 되면, 매개 변수와 지역 변수의 선언문이 먼저 실행되고. 그 결과 생성된 지역 변수와 매개변수가 실행 컨텍스트가 관리하는 지역 스코프에 등록 됩니다.

이때 this 바인딩이 결정 되고, arguments 객체 가 생성됩니다

1. 코드 실행

함수 코드 평가 과정이 진행되면, 매개 변수와 지역변수에 값이 할당 되고, `console.log` 가 호출 됩니다

- console.log 의 실행 방식

### 결론

실행 컨텍스트는 소스코드를 실행하는데 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역입니다. 즉 실행 컨텍스트는 **식별자를 등록하고 관리하는 스코프**와 **코드 실행 순서 관리**를 구현한 것으로, 모든 코드는 실행 컨텍스를 통해 실행 되고 관리됩니다.

### 실행 컨텍스트 스텍

코드 별로 생성된 실행 컨텍스트는 스택자료 구조로 관리되며, 이를 실행 컨텍스트 스택이라 부릅니다.

아래의 코드를 통해 실행 컨텍스트 스택에 대해 알아볼까요?

```jsx
const x = 1;

function foo() {
  const y = 2;

  function bar() {
    const z = 3;
    console.log(x + y + z);
  }
  bar();
}

foo(); // 6
```

일단 코드의 평가와 실행 까지의 단계를 아래의 그림으로 만들어 보았습니다

![Untitled](#23%200b7782bd21e14dba91116ddf0ddaae14/Untitled.png)

그런데 이때, 실행이 끝난 코드의 경우 어떻게 될까요?. 앞에서 스택이라고 이야기한 것과 동일하게, 스택은 후입 선출의 특징을 가지고 있습니다. 즉 나중에 들어간 물건이 먼저 나오는 구조의 형태로 되어있죠. 그래서 일단 bar 함수가 종료 되는 시점으로 돌아가 보겠습니다.

![Untitled](#23%200b7782bd21e14dba91116ddf0ddaae14/Untitled%201.png)

현재 붉은 테두리가 있는 부분이 현재 실행 중인 코드, 즉 실행 중인 실행 컨텍스트 입니다.

bar 함수가 종료된 후, foo 함수에 코드의 제어권이 이동하게 됩니다. 그런데 foo 함수는 이제 더이상 실행할 함수가 존재하지 않기 때문에 종료 되고, 그 제어권은 다시 전역 코드로 이동하게 됩니다.

## 렉시컬 환경

렉시컬이라는 단어를 보았을 때 어떤 생각이 드나요? 저는 한국말로 해주세요 라는 말밖에 생각나지 않습니다. 네.. 쨌든 렉시컬의 단어적의 의미를 먼저 살펴 보겠습니다

Lexical 은 어휘적인 이라는 의미를 가지고 있습니다. 어휘적인이란 ‘어떤 일정한 범위 안에서 쓰이는 낱말의 수효나 전체 낱말에 관한. 또는 그런 것. ‘ 이라는 의미를 가지고 있습니다. 여기서는 식별자 라는 일정 범위 내에 쓰이는 값, 참조 등을 관리하느 환경이라고이해해 보았습니다.

즉 렉시컬 환경은 스코프를 구분하고 식별자를 등록하고 관리하는 역할이라는 것 입니다.

실행 컨텍스는 아래와같은 구조를 지니고 있습니다

![Untitled](#23%200b7782bd21e14dba91116ddf0ddaae14/Untitled%202.png)

바로 렉시컬과, Variable enviroment 컴포넌트로 구성되어있지만, 현재는 두 컴포넌트의 구분을 크게 하지 않고 렉시컬 환경으로 통일해 정리를 진행해 보겠습니다

### 렉시컬 환경의 구성

![Untitled](#23%200b7782bd21e14dba91116ddf0ddaae14/Untitled%203.png)

렉시컬 환경은 위와 같이 구성되어있습니다. 바로 환경 레코드와 외부 렉시컬 환경에 대한 참조인데요 각각은 이와 같은 역할을 하고 있습니다

1. 환경 레코드

스코프에 포함된 식별자를 등록하고, 등록된 식별자에 바인딩 된 값을 관리해 줍니다.

1. 외부 렉시컬

외부 렉시컬 환경에 대한 참조는, 이때 상위 스코프를 이야기 합니다. 이때 상위 스코프는 외부 렉시컬 환경, 즉 실행 컨텍스트를 생성한 소스코드를 포함하는 상위코드의 렉시컬 환경을 이야기합니다.

그리고 이러한 외부 렉시컬의 참조를 통해, 스코프 체인이 구현되는 것을 확인할 수 있습니다
